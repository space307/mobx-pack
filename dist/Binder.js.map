{"version":3,"sources":["../src/lib/Binder.js"],"names":["EMITTER_EVENT","BIND","UNBIND","CALLBACK_CALLED","CALLBACK_NAME","MESSAGE_TYPES","ERROR","WARN","INFO","Binder","parentBinder","services","depsList","pendingStartResolvers","emitter","EventEmitter","allowParentOperation","service","options","addService","subscribe","bind","bindAs","unbind","Service","protoAttrs","Array","isArray","Error","name","serviceStartConfig","binderConfig","proto","onStart","result","resolver","getPendingStartResolver","serviceInBinder","getService","Promise","resolve","started","reject","factory","createService","resolveData","onStartResult","length","destructCallback","callback","serviceList","isListBind","join","getNotBind","funcToCall","parseCallback","apply","getServiceList","then","err","setPendingStartResolver","onStop","onStopFunctionName","validateCallback","isBind","isDebug","showMessage","item","processService","getServiceSettings","saveDeps","handleOnBind","emit","optionsCopy","onUnbind","forEach","__locked","disposers","list","settings","onBindCallbackSetList","onUnbindCallbackSetList","handleOnBindItem","handleOnUnbindItem","lookOverCallback","serviceName","lookOverDeps","depBindAs","callbackSet","applyCallback","checkCallBackResolved","isListUnBind","__resolveTM","clearTimeout","setTimeout","notBind","cbName","callbackType","reduce","acc","push","callbackSetList","cb","len","i","callbackName","slice","isBindOnParent","deps","serviceSettings","importData","unbindData","disposer","unbindDisposers","handleOnUnbind","clear","msg","type","process","env","NODE_ENV","console","log","warn","error","debug","from","to","toVarName","fromVarName","Object","defineProperty","get","configurable","obsr","pass","undefined","value","varName","initiator","raw","s","val","exportData","actionName","serviceInst","arg","api"],"mappings":"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","sourcesContent":["// @flow\n/* eslint-disable method-can-be-static, class-methods-use-this, no-console */\n\n/**\n * Binder - is a DI implementation class. Some classes may to communicate to each other through Binder.\n * Binder register services and call callback functions to resolve dependencies of one service to another\n *\n * Binder operation algorithm\n *  - While service binding to Binder or unbind it notify other services whose\n *  are waiting for it and provide the list of callbacks\n *  which should be called then other services will bind to Binder or unbind too.\n */\n\nimport { each, cloneDeep, includes } from 'lodash';\nimport { toJS } from 'mobx';\nimport { protoName } from './helper/util';\nimport EventEmitter from './helper/EventEmitter.js';\nimport type { ServiceConfigBindAsType,\n  ServiceConfigCallbackSetType,\n  InternalCallbackSetType,\n  BinderConfigType,\n  StartServiceReturnType,\n  ServiceClassType,\n  ServiceStartConfigType,\n} from './typing/common.js';\nimport type { BinderInterface } from './typing/binderInterface.js';\n\n\nconst EMITTER_EVENT = {\n  BIND: 'BIND',\n  UNBIND: 'UNBIND',\n  CALLBACK_CALLED: 'CALLBACK_CALLED',\n};\n\n\nconst CALLBACK_NAME = {\n  BIND: 'onBind',\n  UNBIND: 'onUnbind',\n};\n\nconst MESSAGE_TYPES = {\n  ERROR: 'error',\n  WARN: 'warn',\n  INFO: 'info',\n};\n\n\ntype ServiceSettingsType = {\n  bindAs: ServiceConfigBindAsType,\n  service: *,\n  options: BinderConfigType,\n  disposers:{\n    list: Array<*>,\n    services: *\n  }\n};\n\nclass Binder implements BinderInterface {\n  services: { [key: ServiceConfigBindAsType]: ?ServiceSettingsType } = {};\n\n  depsList: { [key: $Values<typeof CALLBACK_NAME>]:\n      { [key: ServiceConfigBindAsType]: Array<ServiceConfigBindAsType> } } = {\n        [CALLBACK_NAME.BIND]: {},\n        [CALLBACK_NAME.UNBIND]: {},\n      };\n\n  pendingStartResolvers:{ [key: ServiceConfigBindAsType]: Promise<*> } = {};\n\n  parentBinder: BinderInterface;\n\n  emitter: EventEmitter = new EventEmitter();\n\n  allowParentOperation: boolean = false;\n\n  constructor(parentBinder: BinderInterface): void {\n    if (parentBinder instanceof Binder) {\n      this.parentBinder = parentBinder;\n      each(parentBinder.services, ({ service, options }: {service: *, options: BinderConfigType}): void => {\n        this.addService(service, options);\n      });\n\n      parentBinder.emitter.subscribe(EMITTER_EVENT.BIND, ({ service, options }): void => {\n        this.bind(service, options);\n      });\n\n      parentBinder.emitter.subscribe(EMITTER_EVENT.UNBIND, (bindAs: ServiceConfigBindAsType): void => {\n        this.allowParentOperation = true;\n        this.unbind(bindAs);\n        this.allowParentOperation = false;\n      });\n    }\n  }\n\n  createService(Service: ServiceClassType, protoAttrs?: ?Array<*>): * {\n    if (protoAttrs && !Array.isArray(protoAttrs)) {\n      throw new Error(`Wrong ServiceParams! (${Service.name})`);\n    }\n    return protoAttrs ? new Service(...protoAttrs) : new Service();\n  }\n  /**\n   * start and bind service\n   */\n  start(\n    serviceStartConfig: ServiceStartConfigType,\n  ): Promise<*> {\n    const { binderConfig, proto } = serviceStartConfig;\n    const {\n      bindAs,\n      onStart,\n    } = binderConfig;\n\n    let result;\n    const resolver = this.getPendingStartResolver(bindAs);\n    const serviceInBinder = this.getService(bindAs);\n\n\n    if (serviceInBinder) {\n      result = Promise.resolve({ service: serviceInBinder, started: false, serviceStartConfig });\n    } else if (resolver) {\n      result = resolver;\n    } else {\n      result = new Promise(\n        (resolve: (data: StartServiceReturnType) => void, reject: (error: Error) => void): void => {\n          const service = serviceStartConfig.factory ?\n            serviceStartConfig.factory() :\n            this.createService(proto, serviceStartConfig.protoAttrs);\n\n          if (!service || typeof service !== 'object') {\n            throw Error(`Binder service start error. Service \"${bindAs}\" is not a valid object`);\n          } else if (!(service instanceof proto)) {\n            throw Error(`Binder service start error. Service \"${bindAs}\"\n            prototype does not match service factory result`);\n          }\n\n          const resolveData = { service, started: true, serviceStartConfig };\n          let onStartResult;\n\n          if (onStart && !Array.isArray(onStart)) {\n            throw Error(`Binder onStart error. onStart callback of \"${bindAs}\" is not valid`);\n          }\n\n          if (onStart && onStart.length) {\n            const {\n              callback,\n              serviceList,\n              // $FlowIgnore\n            } = this.destructCallback(onStart);\n\n            if (!this.isListBind(serviceList)) {\n              // eslint-disable-next-line max-len\n              throw Error(`Binder onStart error. onStart callback of \"${bindAs}\" wait for service list (${serviceList ? serviceList.join(',') : ''}) to be bind, but some services are not bind ${this.getNotBind(serviceList).join(',')}`);\n            }\n\n            const funcToCall = this.parseCallback(callback, service);\n\n            if (funcToCall) {\n              onStartResult = funcToCall.apply(service, this.getServiceList(serviceList));\n            }\n          }\n\n          if (typeof onStartResult === 'undefined') {\n            this.bind(service, binderConfig);\n            resolve(resolveData);\n          } else if (onStartResult instanceof Promise) {\n            onStartResult\n              .then(\n                (): void => {\n                  this.bind(service, binderConfig);\n                  resolve(resolveData);\n                },\n              )\n              .catch(\n                (err: Error): void => {\n                  reject(err);\n                },\n              );\n          } else if (onStartResult === true) {\n            this.bind(service, binderConfig);\n            resolve(resolveData);\n          } else {\n            reject(new Error(`Service ${bindAs} onStart return \"false\"`));\n          }\n        },\n      ).finally(() => {\n        this.setPendingStartResolver(bindAs, null);\n      });\n\n      this.setPendingStartResolver(bindAs, result);\n    }\n\n    return result;\n  }\n\n  /**\n   * stop and unbind service\n   */\n  stop(serviceStartConfig: ServiceStartConfigType): void {\n    const {\n      bindAs,\n      onStop,\n    } = serviceStartConfig.binderConfig;\n\n    const serviceInBinder = this.getService(bindAs);\n    const onStopFunctionName = onStop || 'onStop';\n\n    if (serviceInBinder) {\n      this.unbind(bindAs);\n      if (typeof serviceInBinder[onStopFunctionName] === 'function') {\n        serviceInBinder[onStopFunctionName]();\n      }\n    }\n  }\n\n\n  /**\n   * bind service to the binder\n   */\n  bind(service: *, options: BinderConfigType): void {\n    if (!options) {\n      throw new Error('Binder options is not valid');\n    }\n\n    const { bindAs } = options;\n\n\n    if (typeof bindAs !== 'string' || !bindAs.length) {\n      throw new Error(`Service \"${protoName(service)}\" has not valid \"bindAs\" id \"${bindAs}\".`);\n    }\n\n    this.validateCallback(options, CALLBACK_NAME.BIND);\n    this.validateCallback(options, CALLBACK_NAME.UNBIND);\n\n    if (this.isBind(bindAs)) {\n      throw new Error(`Service \"${bindAs}\" was already bind.`);\n    }\n\n    if (typeof service !== 'object') {\n      throw new Error(`Service bind param is not an object (\"${bindAs}\").`);\n    }\n\n    this.addService(service, options);\n\n    /* -- Legacy -- */\n    // if legacy service try to bind from this.parentBinder legacy method processService should not be called\n    if (!this.parentBinder) {\n      if (this.isDebug(bindAs)) {\n        this.showMessage(`\"${bindAs}\" bind.`);\n      }\n      each(this.services, (item) => {\n        if (item) {\n          this.processService(item, this.getServiceSettings(bindAs));\n          this.processService(this.getServiceSettings(bindAs), item);\n        }\n      });\n    }\n\n    /* --/ Legacy -- */\n\n    // save OnBind dependencies of the current service\n    this.saveDeps(bindAs, CALLBACK_NAME.BIND);\n    // save OnUnbind dependencies of the current service\n    this.saveDeps(bindAs, CALLBACK_NAME.UNBIND);\n    // check anf resolve dependencies for OnBind events\n    this.handleOnBind(bindAs);\n    // emmit event for child Binders\n    this.emitter.emit(EMITTER_EVENT.BIND, { service, options });\n  }\n\n  /**\n   * add service to the storage of services\n   */\n  addService(service: *, options: BinderConfigType): void {\n    const { bindAs } = options;\n\n    const optionsCopy = cloneDeep(options);\n\n    if (optionsCopy.onUnbind) {\n      optionsCopy.onUnbind.forEach((item) => {\n        // eslint-disable-next-line no-param-reassign\n        item.__locked = true;\n      });\n    }\n\n    this.services[bindAs] = {\n      bindAs,\n      service,\n      options: optionsCopy,\n      disposers: {\n        list: [],\n        services: {},\n      },\n    };\n  }\n\n  /**\n   * look over all OnBind callbacks and resolve dependencies\n   */\n  handleOnBind(bindAs: ServiceConfigBindAsType): void {\n    const settings = this.getServiceSettings(bindAs);\n\n    if (settings) {\n      const onBindCallbackSetList = settings.options && settings.options[CALLBACK_NAME.BIND];\n      const onUnbindCallbackSetList = settings.options && settings.options[CALLBACK_NAME.UNBIND];\n      // check and execute OnBind dependencies of other services on the current service\n      this.handleOnBindItem(bindAs);\n      // check and execute OnUnbind dependencies of other services on the current service\n      this.handleOnUnbindItem(bindAs);\n      // check and execute OnBind dependencies from the list of dependencies of the current service\n      this.lookOverCallback(onBindCallbackSetList, (serviceName) => {\n        this.handleOnBindItem(serviceName);\n      });\n      // check and execute OnUnbind dependencies from the list of dependencies of the current service\n      this.lookOverCallback(onUnbindCallbackSetList, (serviceName) => {\n        this.handleOnUnbindItem(serviceName);\n      });\n    }\n  }\n\n  /**\n   * handle OnBind callback item to resolve it\n   */\n  handleOnBindItem(bindAs: ServiceConfigBindAsType): void {\n    this.lookOverDeps(bindAs, CALLBACK_NAME.BIND,\n      (depBindAs: ServiceConfigBindAsType,\n        callbackSet: InternalCallbackSetType, service: *): void => {\n        const {\n          callback,\n          serviceList,\n        } = this.destructCallback(callbackSet);\n\n        if (!callbackSet.__locked && this.isListBind(serviceList)) {\n          this.applyCallback(depBindAs, callbackSet, serviceList, callback, service, CALLBACK_NAME.BIND);\n        } else {\n          this.checkCallBackResolved(depBindAs, callbackSet, serviceList);\n        }\n      });\n  }\n\n  /**\n   * look over all OnUnbind callbacks and resolve dependencies\n   */\n  handleOnUnbind(bindAs: ServiceConfigBindAsType): void {\n    this.lookOverDeps(bindAs, CALLBACK_NAME.BIND,\n      (depBindAs: ServiceConfigBindAsType, callbackSet: InternalCallbackSetType): void => {\n        const {\n          serviceList,\n        } = this.destructCallback(callbackSet);\n\n        if (callbackSet.__locked && this.isListUnBind(serviceList)) {\n          // eslint-disable-next-line no-param-reassign\n          delete callbackSet.__locked;\n        }\n      });\n\n    this.lookOverDeps(bindAs, CALLBACK_NAME.UNBIND,\n      (depBindAs: ServiceConfigBindAsType, callbackSet: InternalCallbackSetType, service: *): void => {\n        const {\n          callback,\n          serviceList,\n        } = this.destructCallback(callbackSet);\n\n        if (!callbackSet.__locked && this.isListUnBind(serviceList)) {\n          this.applyCallback(depBindAs, callbackSet, serviceList, callback, service, CALLBACK_NAME.UNBIND);\n        }\n      });\n  }\n\n  /**\n   * handle OnUnbind callback item to resolve it\n   */\n  handleOnUnbindItem(bindAs: ServiceConfigBindAsType): void {\n    this.lookOverDeps(bindAs, CALLBACK_NAME.UNBIND,\n      (depBindAs: ServiceConfigBindAsType, callbackSet: InternalCallbackSetType) => {\n        const {\n          serviceList,\n        } = this.destructCallback(callbackSet);\n\n        if (this.isListBind(serviceList) && callbackSet.__locked) {\n          // eslint-disable-next-line no-param-reassign\n          delete callbackSet.__locked;\n        }\n      });\n  }\n\n\n  /**\n   * check if callback was resolved if not send warning to console\n   */\n  checkCallBackResolved(bindAs: ServiceConfigBindAsType,\n    callbackSet: InternalCallbackSetType,\n    serviceList: ?Array<ServiceConfigBindAsType>): void {\n    if (callbackSet.__resolveTM) {\n      clearTimeout(callbackSet.__resolveTM);\n    }\n    // eslint-disable-next-line no-param-reassign\n    callbackSet.__resolveTM = setTimeout(() => {\n      const notBind = this.getNotBind(serviceList);\n      const cbName = callbackSet[callbackSet.length - 1];\n\n      if (serviceList && notBind.length && notBind.length < serviceList.length) {\n        this.showMessage(`\"${bindAs}.${typeof cbName === 'string' ? cbName : CALLBACK_NAME.BIND}\"\n        not called, because \"${notBind.join(',')}\" still not resolved.`, MESSAGE_TYPES.WARN);\n      }\n      // eslint-disable-next-line no-param-reassign\n      delete callbackSet.__resolveTM;\n    }, 1000);\n  }\n\n\n  /**\n   * apply callback\n   */\n\n  applyCallback(bindAs: ServiceConfigBindAsType,\n    callbackSet: InternalCallbackSetType,\n    serviceList: ?Array<ServiceConfigBindAsType>,\n    callback: ?string | ()=>void, service: *, callbackType: $Values<typeof CALLBACK_NAME>): void {\n    const funcToCall = this.parseCallback(callback, service);\n\n    if (funcToCall) {\n      funcToCall.apply(service, callbackType === CALLBACK_NAME.BIND ? this.getServiceList(serviceList) : []);\n\n      // eslint-disable-next-line no-param-reassign\n      callbackSet.__locked = true;\n      this.emitter.emit(EMITTER_EVENT.CALLBACK_CALLED, { bindAs, callbackType, callback, serviceList });\n    } else {\n      throw new Error(`${callbackType} method\n      ${typeof callback === 'string' ? callback : ''} not found in \"${bindAs}\".`);\n    }\n  }\n\n  /**\n   * get list of service id and return service instance list\n   */\n  getServiceList(serviceList: ?Array<ServiceConfigBindAsType>): Array<*> {\n    return serviceList ? serviceList.reduce((acc, bindAs) => {\n      const service = this.getService(bindAs);\n      if (service) {\n        acc.push(service);\n      }\n      return acc;\n    }, [])\n      : [];\n  }\n\n  /**\n   * look over callback list of the service and every iteration call function which was passed as attribute\n   */\n  lookOverCallback(callbackSetList: ?Array<*>,\n    cb: (serviceName: ServiceConfigBindAsType) => void): void {\n    if (callbackSetList) {\n      callbackSetList.forEach((callbackSet: ServiceConfigCallbackSetType): void => {\n        const len = callbackSet.length;\n\n        callbackSet.forEach((serviceName:ServiceConfigBindAsType, i: number): void => {\n          if (i < len - 1) {\n            cb(serviceName);\n          }\n        });\n      });\n    }\n  }\n\n  /**\n   * look over dependency list of the service and every iteration call function which was passed as attribute\n   */\n  lookOverDeps(bindAs: ServiceConfigBindAsType, callbackType: $Values<typeof CALLBACK_NAME>,\n    cb:(depBindAs: ServiceConfigBindAsType, callbackSet: InternalCallbackSetType, service: *)=>void) {\n    const list = this.depsList[callbackType][bindAs];\n\n    if (list && list.length) {\n      list.forEach((depBindAs: ServiceConfigBindAsType): void => {\n        const settings = this.getServiceSettings(depBindAs);\n\n        if (settings) {\n          const callbackSetList = settings.options && settings.options[callbackType];\n          const service = this.getService(depBindAs);\n\n          if (callbackSetList) {\n            callbackSetList.forEach((callbackSet) => {\n              if (includes(callbackSet, bindAs)) {\n                // $FlowIgnore\n                cb(depBindAs, callbackSet, service);\n              }\n            });\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * validate callback set data format\n   */\n  validateCallback(options: BinderConfigType, callbackName: $Values<typeof CALLBACK_NAME>): void {\n    const { bindAs } = options;\n\n    const list = options[callbackName];\n    if (list && list.length) {\n      if (!Array.isArray(list[0])) {\n        throw new Error(`Service \"${bindAs}\" ${callbackName} should contains\n        Array on callback data\"`);\n      } else {\n        this.lookOverCallback(list, (serviceName: ServiceConfigBindAsType): void => {\n          if (bindAs === serviceName) {\n            throw new Error(`Service \"${bindAs}\" ${callbackName} callback contains\n          the same name as service name \"${bindAs}\"`);\n          }\n        });\n\n        list.forEach((callback: ServiceConfigCallbackSetType) => {\n          if (callback.length < 2) {\n            throw new Error(`Service \"${bindAs}\" ${callbackName} should contains\n        Array this at least 2 items, but ${callback.length} given [${callback.join(',')}].\"`);\n          }\n        });\n      }\n    }\n  }\n\n  /**\n   * parse callback\n   */\n  parseCallback(callback: ?string | ()=>void, service: *): ?()=>void {\n    if (typeof callback === 'function') {\n      return callback;\n    } else if (typeof service[callback] === 'function') {\n      return service[callback];\n    }\n    return null;\n  }\n\n  /**\n   * return true if all services from list are bind\n   */\n  isListBind(list: ?Array<ServiceConfigBindAsType>): boolean {\n    return list ? list.reduce((acc, bindAs) => {\n      if (!this.isBind(bindAs)) {\n        // eslint-disable-next-line no-param-reassign\n        acc = false;\n      }\n      return acc;\n    }, true)\n      : false;\n  }\n\n  /**\n   * return list of ids for services which are not bind\n   */\n  getNotBind(list: ?Array<ServiceConfigBindAsType>): Array<ServiceConfigBindAsType> {\n    return list ? list.reduce((acc, bindAs) => {\n      if (!this.isBind(bindAs)) {\n        acc.push(bindAs);\n      }\n      return acc;\n    }, []) : [];\n  }\n\n  /**\n   * return true if all services from list are unbind\n   */\n  isListUnBind(list: ?Array<ServiceConfigBindAsType>): boolean {\n    return list ? list.reduce((acc, bindAs) => {\n      if (this.isBind(bindAs)) {\n        // eslint-disable-next-line no-param-reassign\n        acc = false;\n      }\n      return acc;\n    }, true) : true;\n  }\n\n  /**\n   * return true if service bind to parent Binder\n   */\n  isBindOnParent(bindAs: ServiceConfigBindAsType): boolean {\n    return !!(this.parentBinder && this.parentBinder.isBind(bindAs));\n  }\n\n  /**\n   * destruct callback set to service list and callback function or function name\n   */\n  destructCallback(list: InternalCallbackSetType):\n    {callback: ?string | ()=>void, serviceList: ?Array<ServiceConfigBindAsType>} {\n    const len = list && list.length;\n    const callback = len ? list[len - 1] : null;\n    const serviceList = len ? list.slice(0, len - 1) : null;\n\n    return {\n      serviceList,\n      callback,\n    };\n  }\n\n  /**\n   * return true if service bind\n   */\n  isBind(bindAs: ServiceConfigBindAsType): boolean {\n    return !!(this.services[bindAs] && this.services[bindAs].service);\n  }\n\n  /**\n   * return settings of the service\n   */\n  getServiceSettings(bindAs: ServiceConfigBindAsType): ?ServiceSettingsType {\n    return this.services[bindAs];\n  }\n\n  /**\n   * save hash of dependencies of one service to another\n   */\n  saveDeps(bindAs: ServiceConfigBindAsType, callbackType: $Values<typeof CALLBACK_NAME>): void {\n    if (this.isBindOnParent(bindAs)) {\n      return;\n    }\n\n    const settings = this.getServiceSettings(bindAs);\n\n    if (settings) {\n      const deps = settings.options && settings.options[callbackType];\n\n      if (deps && deps.length) {\n        deps.forEach((list) => {\n          const len = list && list.length;\n          list.forEach((item, i) => {\n            if (i < len - 1) {\n              if (!this.depsList[callbackType][item]) {\n                this.depsList[callbackType][item] = [];\n              }\n              if (!includes(this.depsList[callbackType][item], bindAs)) {\n                this.depsList[callbackType][item].push(bindAs);\n              }\n            }\n          });\n        });\n      }\n    }\n  }\n\n  /**\n   * return promise resolve for starting service\n   */\n  getPendingStartResolver(bindAs:ServiceConfigBindAsType): ?Promise<*> {\n    return this.pendingStartResolvers[bindAs];\n  }\n\n  /**\n   * save promise resolve for starting service to avoid double call of onStart function\n   */\n  setPendingStartResolver(bindAs:ServiceConfigBindAsType, resolver: ?Promise<*>): void{\n    if (resolver) {\n      this.pendingStartResolvers[bindAs] = resolver;\n    } else {\n      delete this.pendingStartResolvers[bindAs];\n    }\n  }\n\n  /**\n   * unbind service\n   */\n  unbind(bindAs: ServiceConfigBindAsType): void {\n    const serviceSettings = this.getServiceSettings(bindAs);\n\n    if (!this.isBind(bindAs)) {\n      this.showMessage(`Service \"${bindAs}\", which are not bind try to unbind!`, MESSAGE_TYPES.WARN);\n      return;\n    }\n\n    if (this.isBindOnParent(bindAs) && !this.allowParentOperation) {\n      throw new Error(`Try to unbind service \"${bindAs}\" from parent Binder.`);\n    }\n\n    /* -- Legacy -- */\n    // unbind data exporting to other services\n    each(this.services, (item) => {\n      if (item) {\n        const importData = item.options.importData && item.options.importData[bindAs];\n        if (importData) {\n          this.unbindData(item.bindAs, importData);\n        }\n      }\n    });\n\n    // unbind data importing from other services\n    if (serviceSettings && serviceSettings.options.importData) {\n      each(serviceSettings.options.importData, (importData) => {\n        this.unbindData(bindAs, importData);\n      });\n    }\n\n    // unbind disposers in this service\n    if (serviceSettings && serviceSettings.disposers) {\n      serviceSettings.disposers.list.forEach((disposer) => {\n        if (typeof disposer === 'function') {\n          disposer();\n        }\n      });\n    }\n\n    // unbind disposers in other services\n    this.unbindDisposers(bindAs);\n\n    if (this.isDebug(bindAs)) {\n      this.showMessage(`\"${bindAs}\" unbind.`);\n    }\n\n    /* --/ Legacy -- */\n\n    // clear service settings in binder\n    delete this.services[bindAs];\n\n    // check and execute dependencies on the OnUnbind event\n    this.handleOnUnbind(bindAs);\n    // emmit event for child services\n    this.emitter.emit(EMITTER_EVENT.UNBIND, bindAs);\n  }\n\n  /**\n   * return bind service\n   */\n  getService(bindAs: ServiceConfigBindAsType): * {\n    const settings = this.getServiceSettings(bindAs);\n    return settings && settings.service;\n  }\n\n  /**\n   * clear all binder data besides services\n   */\n  clear(): void {\n    this.depsList = {\n      [CALLBACK_NAME.BIND]: {},\n      [CALLBACK_NAME.UNBIND]: {},\n    };\n\n    this.pendingStartResolvers = {};\n    this.emitter.clear();\n  }\n  /**\n   * clear all binder data\n   */\n  clearAll(): void {\n    this.clear();\n    this.services = {};\n  }\n\n  /**\n   * show message to console\n   */\n  showMessage(msg: string, type: string = 'info'): void {\n    if (process.env.NODE_ENV === 'test') {\n      return;\n    }\n\n    if (type === MESSAGE_TYPES.INFO) {\n      console.log(`Binder. ${msg}`);\n    } else if (type === MESSAGE_TYPES.WARN) {\n      console.warn(`Binder. ${msg}`);\n    } else if (type === MESSAGE_TYPES.ERROR) {\n      console.error(`Binder. ${msg}`);\n    }\n  }\n\n  /* -- Legacy -- */\n\n  isDebug(bindAs: ServiceConfigBindAsType): ?boolean {\n    const settings = this.getServiceSettings(bindAs);\n    return settings && settings.options ? settings.options.debug : false;\n  }\n\n  processService(from: *, to: *) {\n    if (from.bindAs !== to.bindAs) {\n      const { importData } = to.options;\n\n      if (importData && importData[from.bindAs]) {\n        each(importData[from.bindAs], (toVarName, fromVarName) => {\n          if (!(fromVarName in from.service)) {\n            this.showMessage(`Variable \"${fromVarName}\" required for \"${to.bindAs}\"\n            not found in \"${from.bindAs}\"`, MESSAGE_TYPES.WARN);\n            return;\n          }\n\n          if (toVarName in to.service) {\n            this.showMessage(`Trying create link from \"${from.bindAs}.${fromVarName}\"\n            to \"${to.bindAs}.${toVarName}\", but variable \"${toVarName}\" is already exist in \"${to.bindAs}\"`,\n            MESSAGE_TYPES.WARN);\n            return;\n          }\n\n          Object.defineProperty(to.service, toVarName, {\n            get: () => {\n              if (this.isDebug(to.bindAs)) {\n                this.showMessage(`Variable \"${fromVarName}\" from \"${from.bindAs}\"\n              was taken by \"${to.bindAs}\" with name \"${toVarName}\"`);\n              }\n\n              return from.service[fromVarName];\n            },\n            configurable: true,\n          });\n        });\n      }\n    }\n  }\n\n  addDisposer(bindAs: ServiceConfigBindAsType, services: *, obsr: *) {\n    const serviceSettings = this.getServiceSettings(bindAs);\n    let pass = true;\n\n    services.forEach((serviceName) => {\n      if (!this.isBind(serviceName)) {\n        this.showMessage(`Impossible add disposer for not bind service \"${bindAs}\".`, MESSAGE_TYPES.WARN);\n        pass = false;\n      }\n    });\n\n    if (pass && serviceSettings) {\n      serviceSettings.disposers.list.push(obsr);\n\n      services.forEach((serviceName) => {\n        if (!serviceSettings.disposers.services[serviceName]) {\n          serviceSettings.disposers.services[serviceName] = [];\n        }\n\n        serviceSettings.disposers.services[serviceName].push(serviceSettings.disposers.list.length - 1);\n      });\n    }\n\n    return pass;\n  }\n\n  unbindDisposers(bindAs: ServiceConfigBindAsType) {\n    each(this.services, (service) => {\n      if (service && service.disposers.services[bindAs]) {\n        service.disposers.services[bindAs].forEach((disposer) => {\n          if (typeof service.disposers.list[disposer] === 'function') {\n            service.disposers.list[disposer]();\n            // eslint-disable-next-line no-param-reassign\n            service.disposers.list[disposer] = undefined;\n          }\n        });\n      }\n    });\n  }\n\n  unbindData(bindAs: ServiceConfigBindAsType, importData: *) {\n    const settings = this.getServiceSettings(bindAs);\n    if (settings) {\n      const { service } = settings;\n      each(importData, (toVarName) => {\n        if (toVarName in service) {\n          Object.defineProperty(service, toVarName, { value: undefined });\n        }\n      });\n    }\n  }\n\n  importVar(serviceName: ServiceConfigBindAsType, varName: string, initiator: string, raw: *) {\n    const s = this.getServiceSettings(serviceName);\n    const service = s && s.service ? s.service : null;\n    let val;\n    let exportData;\n\n    if (s && s.service && service) {\n      exportData = s.options.exportData;\n\n      if (exportData && !exportData[varName]) {\n        console.warn(`Warnning! Impossible import variable \"${varName}\" of\n        \"${s.bindAs}\" for \"${initiator}\" because variable is not included to config.exportData.`);\n        return;\n      }\n\n      val = service[varName];\n      if (s.debug) {\n        console.log(`Binder. \"${initiator}\" import variable \"${varName}\" from \"${serviceName}\".`, val);\n      }\n      return raw ? val : toJS(val); // eslint-disable-line\n    }\n\n    console.warn(`Warnning! importVar form \"${protoName(this)}\" to\n    \"${initiator}\". \"${serviceName}\" service not found.`);\n\n    return undefined; // eslint-disable-line\n  }\n\n  callApi(serviceName: ServiceConfigBindAsType,\n    actionName: ServiceConfigBindAsType,\n    initiator: ServiceConfigBindAsType, ...arg: Array<*>) {\n    if (process.env.NODE_ENV === 'test') {\n      return;\n    }\n    const s = this.getServiceSettings(serviceName);\n    let serviceInst;\n\n    if (s && s.service) {\n      serviceInst = s.service;\n\n      if (s.options.debug) {\n        console.log(`Binder callApi. \"${initiator}\" calls method \"${actionName}\" from \"${serviceName}\".`, arg);\n      }\n\n      if (serviceInst.api && serviceInst.api[actionName]) {\n        return serviceInst.api[actionName].apply(serviceInst, arg); // eslint-disable-line\n      }\n      console.warn(`CallApi warn. \"${initiator}\" calls unknown method\n      \"${actionName}\" found in service \"${serviceName}\".`);\n    } else {\n      console.warn(`CallApi warn. \"${initiator}\" calls method \"${actionName}\" from not bind service \"${serviceName}\".`);\n    }\n  }\n  /* --/ Legacy -- */\n}\n\nexport default Binder;\n"],"file":"Binder.js"}